define("controller/routes",[],function(){"use strict";return{Main:{actions:{index:"controller/main",entry:"controller/entry",getSectionActions:"controller/main/actions",getSectionTrees:"controller/main/trees",login:"controller/login"}},PasswordRecovery:{actions:{index:"controller/passwordRecovery"}},Lock:{actions:{locked:"controller/Lock/locked"}},ExtensionsManager:{actions:{index:"controller/settings/extensionManager"}},Users:{deps:"controller/users/disable-edit",actions:{index:"controller/users/index",add:"controller/users/add"}}}}),define("controller/app",["lodash","jquery","core/historyRouter","core/logger","core/eventifier","core/statifier","util/url","ui/feedback","layout/logout-event"],function(_,$,historyRouterFactory,loggerFactory,eventifier,statifier,urlUtil,feedback,logoutEvent){
"use strict";var historyRouter,redirectUrl,appLogger=loggerFactory("controller/app"),appController=eventifier(statifier({start:function(options){var currentRoute;appController.apply(),currentRoute=options&&options.forwardTo?options.forwardTo:window.location+"",options&&options.redirectUrl&&(redirectUrl=options.redirectUrl||{}),historyRouter.forward(currentRoute)},apply:function(selector,target){return selector=selector||".router",target=target||document,$(target).off("click.appController").on("click.appController",selector,function(e){var $elt,href;e.preventDefault(),$elt=$(this),href=$elt.attr("href"),href||(href=$("[href]:first-child",$elt).attr("href")),href&&historyRouter.redirect(href);
}),this},getRouter:function(){return historyRouter},getLogger:function(){return appLogger},onError:function(err){var message=err&&err.message||err,options={message:message};return appLogger.error(err),403===err.code?(options=_.defaults(options,redirectUrl||{}),logoutEvent(options)):feedback().error(message),this}}));return historyRouter=historyRouterFactory().on("dispatching",function(url){appController.setState("dispatching"),appController.trigger("change",url)}).on("dispatched",function(url){appController.setState("dispatching",!1),appController.trigger("started",url)}),appController}),define("controller/entry",["jquery","lodash","i18n","ui/feedback"],function($,_,__,feedback){
"use strict";return{start:function(){var $container=$("#entry-point-box"),errorMessage=$container.data("errormessage");errorMessage&&feedback().error(errorMessage)}}}),define("controller/Lock/locked",["jquery","i18n","helpers","lock","layout/section","ui/feedback"],function($,__,helpers,Lock,sectionApi,feedback){"use strict";return{start:function(){$(".forcerelease").click(function(e){e.preventDefault(),$.ajax({url:helpers._url("forceRelease","Lock","tao"),type:"POST",data:{uri:$(this).data("id")},dataType:"json",success:function(response){response.success?(feedback().success(__("The lock has been released")),$(".tree").trigger("refresh.taotree")):feedback().error(__("Unable to release the lock"));
},error:function(){feedback().error(__("Unable to release the lock"))}})})}}}),define("controller/main",["module","jquery","lodash","context","router","helpers","uiForm","util/url","core/logger","layout/generisRouter","layout/section","layout/actions","layout/version-warning","layout/loading-bar","layout/nav","layout/search","layout/tree/loader","layout/section-height"],function(module,$,_,context,router,helpers,uiForm,urlUtil,loggerFactory,generisRouter,sections,actionManager,versionWarning,loadingBar,nav,search,treeLoader,sectionHeight){"use strict";var logger=loggerFactory("controller/main"),sectionTree=function($container,section){var treeProvider,treeActions=_.reduce($container.data("actions"),function(acc,id,key){
var action=actionManager.getBy(id);return action&&(acc[key]=action),acc},{}),treeUrl=urlUtil.build([context.root_url,$container.data("url")]),treeType=$container.data("type");return treeProvider=treeLoader(treeType),treeType||$container.data("type",treeProvider.name),treeProvider.init($container,{id:$container.attr("id"),url:treeUrl,rootClassUri:$container.data("rootnode"),icon:$container.data("icon"),actions:treeActions,sectionId:section.id,loadNode:section.defaultUri})};return{start:function(){var config=module.config(),$doc=$(document);versionWarning.init(),generisRouter.init(),$doc.ajaxSend(function(){loadingBar.start()}),$doc.ajaxComplete(function(){loadingBar.stop();
}),nav.init(),sections.on("activate",function(section){if(window.scrollTo(0,0),section&&section.id)switch(context.section=section.id,actionManager.init(section.panel),search.init(),section.type){case"tree":section.panel.addClass("content-panel"),sectionHeight.init(section.panel),$(".taotree",section.panel).each(function(){var $treeElt=$(this),$actionBar=$(".tree-action-bar-box",section.panel);sectionTree($treeElt,section).then(function(){$actionBar.addClass("active"),sectionHeight.setHeights(section.panel)}).catch(function(err){logger.error(err)})}),$(".navi-container",section.panel).show();break;case"content":this.loadContentBlock()}}).init(),helpers.init(),
uiForm.init(),config&&_.isArray(config.extraRoutes)&&_.forEach(config.extraRoutes,function(route){router.dispatch(route)})}}}),define("controller/passwordRecovery",["jquery","i18n","module","ui/feedback","layout/version-warning"],function($,__,module,feedback,versionWarning){"use strict";var feedbackType,conf=module.config();if(versionWarning.init(),conf.message)for(feedbackType in conf.message)conf.message[feedbackType]&&feedback()[feedbackType](conf.message[feedbackType])}),define("controller/settings/extensionManager",["jquery","i18n","context","helpers","ui/feedback"],function($,__,context,helpers,feedback){function getDependencies(extension){var dependencies=[];
return $("#"+extension+" .dependencies li:not(.installed)").each(function(){var ext=$(this).attr("rel"),deps=getDependencies(ext);deps.push(ext),dependencies=dependencies.concat(deps)}),dependencies}function getUnique(orig){for(var a=[],i=0;i<orig.length;i++)$.inArray(orig[i],a)<0&&a.push(orig[i]);return a}function progressConsole(msg){$("#installProgress .console").append("<p>"+msg+"</p>"),$("#installProgress .console").prop({scrollTop:$("#installProgress .console").prop("scrollHeight")})}function installNextExtension(){var ext=toInstall[indexCurrentToInstall];$("#installProgress p.status").text(__("Installing extension %s...").replace("%s",ext)),progressConsole(__("Installing extension %s...").replace("%s",ext)),
$.ajax({type:"POST",url:helpers._url("install","ExtensionsManager","tao"),data:"id="+ext,dataType:"json",success:function(data){helpers.loaded(),data.success?(progressConsole(__("> Extension %s succesfully installed.").replace("%s",ext)),$("li.ext-id.ext-"+ext).addClass("installed"),$("tr#"+ext).slideUp("normal",function(){var $tr=$("<tr></tr>").appendTo($("#extensions-manager-container tbody")).hide(),$orig=$("tr#"+ext+" td");$tr.append('<td class="ext-id bordered">'+$($orig[0]).text()+"</td>"),$tr.append('<td class="author">'+$($orig[1]).text()+"</td>"),$tr.append('<td class="version">'+$($orig[2]).text()+"</td>"),$tr.slideDown("normal",function(){$("tr#"+ext).remove(),
styleTables(),0==$("#available-extensions-container table tbody tr").length&&noAvailableExtensions(),$("#installProgress .bar").animate({width:"+="+percentByExt+"%"},1e3,function(){indexCurrentToInstall++,hasNextExtensionToInstall()})})})):(installError=1,progressConsole("Installation of "+ext+" failed")),feedback().info(data.message)}}),installError&&progressConsole(__("A fatal error occured during the installation process."))}function postInstall(){return progressConsole(__("Post install processing")),$.ajax({type:"GET",url:helpers._url("postInstall","ExtensionsManager","tao")})}function hasNextExtensionToInstall(){indexCurrentToInstall>=toInstall.length?(toInstall=[],
$("#installProgress .bar").animate({backgroundColor:"#bb6",width:"100%"},1e3),postInstall().done(function(data){helpers.loaded(),$("#installProgress .bar").animate({backgroundColor:"#6b6"},1e3),$("#installProgress p.status").text(__("Installation done.")),progressConsole(__("> Installation done.")),progressConsole(__("... reloading page.")),setTimeout(function(){window.location.reload(!0)},1e3)})):installNextExtension()}function styleTables(){$("#Extensions_manager table tr").removeClass("extensionOdd").removeClass("extensionEven"),$("#Extensions_manager table tr:nth-child(even)").addClass("extensionEven"),$("#Extensions_manager table tr:nth-child(odd)").addClass("extensionOdd");
}function noAvailableExtensions(){var $noAvailableExtElement=$("<div/>");$noAvailableExtElement.attr("id","noExtensions").addClass("ui-state-highlight").text(__("No extensions available.")),$("#available-extensions-container").empty().append($noAvailableExtElement)}var ext_installed=[],toInstall=[],indexCurrentToInstall=-1,percentByExt=0,installError=0;return{start:function(){styleTables(),$("#installProgress").hide(),$("#extensions-manager-container .ext-id").each(function(){var ext=$(this).text();ext_installed.push(ext),$(".ext-id.ext-"+ext).addClass("installed")}),$("#available-extensions-container tr input").click(function(event){event.stopPropagation()}),
$("#available-extensions-container tr input:checkbox").click(function(){var $installButton=$("#installButton");$(this).parent().parent().parent().find("input:checkbox:checked").length>0?$installButton.attr("disabled",!1):$installButton.attr("disabled",!0)}),$("#available-extensions-container #installButton").click(function(event){return toInstall=[],$("#available-extensions-container input:checked").each(function(){var ext=$(this).prop("name").split("_")[1],deps=getDependencies(ext);deps.length&&(toInstall=toInstall.concat(deps)),toInstall.push(ext)}),toInstall=getUnique(toInstall),toInstall.length?(percentByExt=100/toInstall.length,$("#installProgress p.status").text(__("%s extension(s) to install.").replace("%s",toInstall.length)),
$("#installProgress .bar").width(0),$("#installProgress .console").empty(),progressConsole(__("Do you wish to install the following extension(s):\n%s?").replace("%s",toInstall.join(", "))),$("#installProgress").dialog({modal:!0,width:400,height:300,buttons:[{text:__("No"),click:function(){$(this).dialog("close")}},{text:__("Yes"),click:function(){progressConsole(__("Preparing installation...")),$(".ui-dialog-buttonpane").remove(),installError=0,indexCurrentToInstall=0,installNextExtension()}}]}),void event.preventDefault()):(window.alert(__("Nothing to install !")),!1)})}}}),define("controller/users/add",["jquery","module","helpers","users"],function($,module,helpers,users){
"use strict";return{start:function(){var conf=module.config(),url=helpers._url("checkLogin","Users","tao");users.checkLogin(conf.loginId,url),conf.exit===!0&&setTimeout(function(){window.location=helpers._url("index","Main","tao",{structure:"users",ext:"tao",section:"list_users"})},1e3)}}}),define("controller/users/disable-edit",["layout/section"],function(section){"use strict";return{start:function(){section.get("edit_user").disable()}}}),define("controller/users/index",["module","jquery","i18n","helpers","layout/section","ui/feedback","ui/datatable"],function(module,$,__,helpers,section,feedback){"use strict";var editUser=function(uri){section.get("edit_user").enable().loadContentBlock(helpers._url("edit","Users","tao"),{
uri:uri}).show()},removeUser=function(uri){var tokenName=module.config().xsrfTokenName,data={};data.uri=uri,data[tokenName]=$.cookie(tokenName),window.confirm(__("Please confirm user deletion"))&&$.ajax({url:helpers._url("delete","Users","tao"),data:data,type:"POST"}).done(function(response){response.deleted?feedback().success(response.message):feedback().error(response.message),$("#user-list").datatable("refresh")})};return{start:function(){var $userList=$("#user-list");section.on("show",function(section){"list_users"===section.id&&$userList.datatable("refresh")}),$userList.datatable({url:helpers._url("data","Users","tao"),filter:!0,actions:{edit:editUser,remove:removeUser
},model:[{id:"login",label:__("Login"),sortable:!0},{id:"firstname",label:__("First Name"),sortable:!0},{id:"lastname",label:__("Last Name"),sortable:!0},{id:"email",label:__("Email"),sortable:!0},{id:"roles",label:__("Roles"),sortable:!1},{id:"dataLg",label:__("Data Language"),sortable:!0},{id:"guiLg",label:__("Interface Language"),sortable:!0}]})}}});
//# sourceMappingURL=controllers.min.js.map